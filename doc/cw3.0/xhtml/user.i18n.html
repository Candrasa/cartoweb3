<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>14. Internationalization</title>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.68.1" />
    <link rel="start" href="index.html" title="CartoWeb Documentation" />
    <link rel="up" href="cartoweb.user.html" title="Part II. User Manual" />
    <link rel="prev" href="user.security.html" title="13. Security Configuration" />
    <link rel="next" href="user.template.html" title="15. Templating" />
  </head>
  <body>
    <div id="navtoc">
      <div id="nav">
        <dl>
          <dt>
            <a accesskey="h" href="index.html">CartoWeb Documentation</a>
          </dt>
          <dt>
            <a accesskey="u" href="cartoweb.user.html">User Manual</a>
          </dt>
        </dl>
      </div>
      <div id="toc">
        <p>Table of Contents</p>
        <dl>
          <dt>
            <span class="sect1">
              <a href="user.i18n.html#user.i18n.translations">14.1. Translations</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="sect2">
                  <a href="user.i18n.html#user.i18n.translations.config">14.1.1. Configuration</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.i18n.html#user.i18n.translations.template">14.1.2. PO Templates</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.i18n.html#user.i18n.translations.translating">14.1.3. Translating</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.i18n.html#user.i18n.translations.compiling">14.1.4. Compiling PO to MO</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.i18n.html#user.i18n.translations.example">14.1.5. Example</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="sect1">
              <a href="user.i18n.html#user.i18n.encoding">14.2. Character Set Encoding Configuration</a>
            </span>
          </dt>
        </dl>
      </div>
      <div id="w3c">
        <a href="http://validator.w3.org/">
          <img src="image/xhtml.png" width="88" height="31" alt="valid xhtml 1.0" />
        </a>
        <a href="http://jigsaw.w3.org/css-validator/">
          <img src="image/css.png" width="88" height="31" alt="valid css" />
        </a>
      </div>
    </div>
    <div id="title">
      <h2 class="title"><a id="user.i18n"></a>14. Internationalization</h2>
    </div>
    <div id="content">
      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage"></div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.i18n.translations"></a>14.1. Translations</h2>
              </div>
            </div>
          </div>
          <p> Translation handling in CartoWeb was designed to use <a href="http://www.gnu.org/software/gettext/manual">gettext</a>. However 
      internationalization architecture is ready for other translation 
      systems.</p>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.i18n.translations.config"></a>14.1.1. Configuration</h3>
                </div>
              </div>
            </div>
            <p> For now only gettext translation system is implemented. If gettext 
        is not installed, you can use a dummy translation system which 
        translates nothing. To use gettext, you will need to have PHP gettext 
        module installed.</p>
            <p>Choosen translation system is set in client configuration file 
        <code class="filename">client_conf/client.ini</code>: </p>
            <pre class="programlisting">### Internationalization ###

# I18n class
# use I18nDummy for no translation management
# use I18nGettext for gettext (will need PHP gettext module)
I18nClass = I18nDummy</pre>
            <p> </p>
            <div class="sect3" lang="en" xml:lang="en">
              <div class="titlepage">
                <div>
                  <div>
                    <h4 class="title"><a id="user.i18n.translations.config.linux"></a>14.1.1.1. Unix-like</h4>
                  </div>
                </div>
              </div>
              <p>In Unix-like environments, file 
          <code class="filename">/etc/locale.alias</code> contains aliases to installed 
          locales. For each language used, a line must be present in this file. 
          The alias ('fr' in the example below) must point to a locale 
          installed on the system. </p>
              <pre class="programlisting">...
fr    fr_CH.ISO-8859-1
...</pre>
              <p>You will need to run <span><strong class="command">locale-gen</strong></span> after 
          editing <code class="filename">/etc/locale.alias</code> to regenerate system's 
          locales. </p>
              <p> To install a locale on a Debian installation, use following 
          command with root priviledges: </p>
              <pre class="screen">dpkg-reconfigure locales
           </pre>
              <p> If package locales has never been installed, you have to 
          install it before: </p>
              <pre class="screen">apt-get install locales 
          </pre>
              <p> </p>
            </div>
            <div class="sect3" lang="en" xml:lang="en">
              <div class="titlepage">
                <div>
                  <div>
                    <h4 class="title"><a id="user.i18n.translations.config.win32"></a>14.1.1.2. Win32</h4>
                  </div>
                </div>
              </div>
              <p>TODO </p>
            </div>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.i18n.translations.template"></a>14.1.2. PO Templates</h3>
                </div>
              </div>
            </div>
            <p> Texts to be translated can be found in: </p>
            <div class="itemizedlist">
              <ul>
                <li> Smarty templates using <a href="http://smarty.incutio.com/?page=SmartyGettext">SmartyGettext</a> 
            (see <a href="user.template.html#user.template.i18n" title="15.2. Internationalization">Section 15.2, &#8220;Internationalization&#8221;</a>)</li>
                <li> Client plugins .ini files (for instance map sizes) </li>
                <li> Server plugins .ini files (for instance scales labels) </li>
                <li> Mapfile's .ini and .map (layers labels) </li>
                <li> Client and server PHP code (see <a href="dev.i18n.html#dev.i18n.translations" title="4.1. Translations">Section 4.1, &#8220;Translations&#8221;</a>) </li>
              </ul>
            </div>
            <p> To generate PO templates, you will need to launch scripts on 
        server and on client. Templates are generated in directory 
        <code class="filename">&lt;cartoweb_home&gt;/po</code>. If translation files 
        (see <a href="user.i18n.html#user.i18n.translations.translating" title="14.1.3. Translating">Section 14.1.3, &#8220;Translating&#8221;</a>) already 
        exist, a merge is done using <a href="http://www.gnu.org/software/gettext/manual/html_chapter/gettext_6.html#SEC37"><span><strong class="command">msgmerge</strong></span></a> 
        command. Follow these steps:</p>
            <div class="itemizedlist">
              <ul>
                <li>generate project and mapfile templates on server: <pre class="screen">cd &lt;cartoweb_home&gt;/scripts
./server2pot.php</pre>For each mapfile, two templates will be generated: 
            <code class="filename">server-&lt;project_name&gt;.po</code> and 
            <code class="filename">server-&lt;project_name&gt;.&lt;mapfile_name&gt;.po</code></li>
                <li>generate project template on client:<pre class="screen">cd &lt;cartoweb_home&gt;/scripts
./client2pot.php</pre>For each project, one template will be generated: 
            <code class="filename">client-&lt;project_name&gt;.po</code></li>
              </ul>
            </div>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.i18n.translations.translating"></a>14.1.3. Translating</h3>
                </div>
              </div>
            </div>
            <p> As for any gettext system, translating PO files can be done in 
        Emacs, in <a href="http://poedit.sourceforge.net/">Poedit</a> or 
        in any text editor. </p>
            <p> Translated PO files must be saved under name 
        <code class="filename">&lt;template_name&gt;.&lt;lang&gt;.po</code> ; where 
        &lt;lang&gt; is the 2-letters ISO language: en, fr, de, etc.. For 
        instance, the mapfile test of default project will have three PO files 
        for a complete french translation: </p>
            <div class="itemizedlist">
              <ul>
                <li>
            <code class="filename">server-default.po</code>
          </li>
                <li>
            <code class="filename">server-default.test.po</code>
          </li>
                <li>
            <code class="filename">client-default.po</code>
          </li>
              </ul>
            </div>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.i18n.translations.compiling"></a>14.1.4. Compiling PO to MO</h3>
                </div>
              </div>
            </div>
            <p> To compile all PO files to MO files (gettext's binary format), use 
        the following commands on client side. This should be done each time 
        configuration (client or server) is updated, and after each system 
        update. All languages are compiled at the same time. </p>
            <pre class="screen">cd &lt;cartoweb_home&gt;/scripts
./po2mo.php</pre>
            <p> Warning: When CartoWeb is installed in SOAP mode, the 
        script uses PHP curl functions to retrieve PO files from server to 
        client. PHP curl module must be installed. </p>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.i18n.translations.example"></a>14.1.5. Example</h3>
                </div>
              </div>
            </div>
            <p> To translate texts in french for project testproject and map file 
        projectmap, follow these steps: </p>
            <div class="itemizedlist">
              <ul>
                <li> On server: <pre class="screen">cd &lt;cartoweb_home&gt;/scripts
./server2pot.php</pre> Copy 
            <code class="filename">&lt;cartoweb_home&gt;/po/server-testproject.po</code> 
            to 
            <code class="filename">&lt;cartoweb_home&gt;/po/server-testproject.fr.po</code> 
            and 
            <code class="filename">&lt;cartoweb_home&gt;/po/server-testproject.projectmap.po</code> 
            to 
            <code class="filename">&lt;cartoweb_home&gt;/po/server-testproject.projectmap.fr.po</code>. 
            Edit french files with Poedit (or any editor). </li>
                <li> On client: <pre class="screen">cd &lt;cartoweb_home&gt;/scripts
./client2pot.php</pre> Copy 
            <code class="filename">&lt;cartoweb_home&gt;/po/client-testproject.po</code> 
            to 
            <code class="filename">&lt;cartoweb_home&gt;/po/client-testproject.fr.po</code>. 
            Edit french file with Poedit (or any editor).  Merge and compile files with the following commands: <pre class="screen">cd &lt;cartoweb_home&gt;/scripts
./po2mo.php</pre> Now you should have the file 
            <code class="filename">testproject.projectmap.mo</code> in directory 
            <code class="filename">&lt;cartoweb_home&gt;/locale/fr/LC_MESSAGES</code>. 
            The directory <code class="filename">fr/LC_MESSAGES</code> will be created 
            if it does not exist. </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.i18n.encoding"></a>14.2. Character Set Encoding Configuration</h2>
              </div>
            </div>
          </div>
          <p> Character set configuration is needed when CartoWeb strings may 
      include international characters with accents, or other special 
      characters. Two types of encodings must be set: </p>
          <div class="itemizedlist">
            <ul>
              <li>how files (map files, configuration files, etc.) are encoded on 
          server and on client. To set this encoding, add the following line in 
          <code class="filename">server.ini</code> and in 
          <code class="filename">client.ini</code>:<pre class="programlisting">
EncoderClass.config = &lt;encoder_class&gt;</pre> </li>
              <li>how CartoWeb exports (including HTML output) must be encoded. 
          To set this encoding, add the following line in 
          <code class="filename">client.ini</code>:<pre class="programlisting">
EncoderClass.output = &lt;encoder_class&gt;</pre> </li>
            </ul>
          </div>
          <p>Where &lt;encoder_class&gt; is the class used for encoding. 
      Currently, following encoder classes are implemented: </p>
          <div class="itemizedlist">
            <ul>
              <li><code class="classname">EncoderISO</code>: handles strings coded in 
          ISO-8859-1 </li>
              <li><code class="classname">EncoderUTF</code>: handles strings coded in 
          UTF-8</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
