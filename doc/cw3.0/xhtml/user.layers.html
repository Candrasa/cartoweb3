<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>6. Layers</title>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.68.1" />
    <link rel="start" href="index.html" title="CartoWeb Documentation" />
    <link rel="up" href="cartoweb.user.html" title="Part II. User Manual" />
    <link rel="prev" href="user.caches.html" title="5. Caches Configuration" />
    <link rel="next" href="user.location.html" title="7. Navigation" />
  </head>
  <body>
    <div id="navtoc">
      <div id="nav">
        <dl>
          <dt>
            <a accesskey="h" href="index.html">CartoWeb Documentation</a>
          </dt>
          <dt>
            <a accesskey="u" href="cartoweb.user.html">User Manual</a>
          </dt>
        </dl>
      </div>
      <div id="toc">
        <p>Table of Contents</p>
        <dl>
          <dt>
            <span class="sect1">
              <a href="user.layers.html#user.layers.intro">6.1. Introduction</a>
            </span>
          </dt>
          <dt>
            <span class="sect1">
              <a href="user.layers.html#user.layers.tree">6.2. Hierarchy of Layers and Rendering</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="sect2">
                  <a href="user.layers.html#user.layers.tree.types">6.2.1. Layers and LayerGroups</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.layers.html#user.layers.tree.layers">6.2.2. Layers Options</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.layers.html#user.layers.tree.layergroups">6.2.3. LayerGroups Options</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="sect1">
              <a href="user.layers.html#user.layers.metadata">6.3. Metadata in Mapfile and <code class="filename">layers.ini</code></a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="sect2">
                  <a href="user.layers.html#user.layers.metadata.mapfile">6.3.1. Metadata in Mapfiles</a>
                </span>
              </dt>
              <dt>
                <span class="sect2">
                  <a href="user.layers.html#user.layers.metadata.inifile">6.3.2. Metadata in <code class="filename">layers.ini</code></a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="sect1">
              <a href="user.layers.html#user.layers.legend">6.4. Layers Legends</a>
            </span>
          </dt>
        </dl>
      </div>
      <div id="w3c">
        <a href="http://validator.w3.org/">
          <img src="image/xhtml.png" width="88" height="31" alt="valid xhtml 1.0" />
        </a>
        <a href="http://jigsaw.w3.org/css-validator/">
          <img src="image/css.png" width="88" height="31" alt="valid css" />
        </a>
      </div>
    </div>
    <div id="title">
      <h2 class="title"><a id="user.layers"></a>6. Layers</h2>
    </div>
    <div id="content">
      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage"></div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.layers.intro"></a>6.1. Introduction</h2>
              </div>
            </div>
          </div>
          <p> Geographical data are most often apprehended as thematic layers: 
      you may have a layer "Rivers", a layer "Aerial view", a layer "Average 
      income", just to cite a few examples. Now the basic purpose of any viewer 
      is to make these data available to users by allowing navigation within a 
      layer as well as comparison between layers. A way to organize the layers 
      is thus mandatory if an user-friendly application is to be developed. In 
      CartoWeb, the files that contain the configuration instructions for the 
      layers are on the server-side, in the directory 
      <code class="filename">server_conf/&lt;myMap&gt;</code>. Usually this directory is 
      part of a project. </p>
          <p> CartoWeb is based on the geographical engine Mapserver. The 
      Mapserver documentation <a href="http://mapserver.gis.umn.edu/doc.html"> 
      http://mapserver.gis.umn.edu/doc.html</a> is an integral part of the 
      CartoWeb doc. To be concise, you have to know how to write a mapfile if 
      you want to use CartoWeb. So it doesn't come as a surprise that a 
      mapfile, <code class="filename">myMap.map</code>, is included in the 
      <code class="filename">&lt;myMap&gt;</code> directory, together with its annexes 
      (typically a symbol file <code class="filename">myMap.sym</code>, a directory 
      <code class="filename">etc</code> for the required fonts, the graphic file used as 
      keymap background, maybe also data files). </p>
          <p> We'll see that some functionalities of CartoWeb require small 
      changes of the mapfile content. But most of the configuration is done in 
      the file <code class="filename">layers.ini</code>. </p>
          <p> The file <code class="filename">myMap.ini</code> sets the required plugins 
      and the initial state of the map. Its content is described in <a href="user.config.html" title="4. Configuration Files">Chapter 4, <i>Configuration Files</i></a> </p>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.layers.tree"></a>6.2. Hierarchy of Layers and Rendering</h2>
              </div>
            </div>
          </div>
          <p> Contrary to Mapserver itself, CartoWeb supports an arbitrarily 
      complex hierarchy of layers and different rendering options. The notion 
      of LayerGroup makes it possible. </p>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.layers.tree.types"></a>6.2.1. Layers and LayerGroups</h3>
                </div>
              </div>
            </div>
            <p> There are two types of "layers-like objects" in 
        <code class="filename">layers.ini</code> : Layers and LayerGroups. They play 
        fairly different roles and consequently have different possible 
        attributes. Layers have a 1-to-1 correspondance to Mapserver layers (as 
        defined in the <code class="filename">layers.map</code>), while LayerGroups 
        group together atomic Layers or other LayerGroups. </p>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.layers.tree.layers"></a>6.2.2. Layers Options</h3>
                </div>
              </div>
            </div>
            <p> As seen before, the Layer object maps directly to a layer in the 
        mapfile. By default, all layers in the mapfile are made available as a 
        Layer in the layers.ini, with an identifier having the same name as the 
        name of the mapserver layer. Thus, if you have the following option in 
        your mapfile:</p>
            <pre class="programlisting">LAYER
  NAME "my_layer"
  TYPE line 
END</pre>
            <p> This is equivalent as writing the following configuration in the 
        <code class="filename">layers.ini</code>: </p>
            <pre class="programlisting">layers.my_layer.class = Layer 
layers.my_layer.label = my_layer
layers.my_layer.msLayer = my_layer</pre>
            <div class="tip">
              <h3 class="title">Tip</h3>
              <p>If you don't need special parameters (see below) for your layer 
          then you can avoid adding it in the 
          <code class="filename">layers.ini</code></p>
            </div>
            <p>However, if you want these layers to appear in the layer list, you 
        still have the responsibility to affect them a parent layer, using the 
        <code class="literal">children</code> property of the 
        <code class="literal">LayerGroup</code> layer declarations. </p>
            <p> <a id="id2606653" class="indexterm"></a> Here is the 
        syntax for the various configuration parameters of a Layer.</p>
            <div class="itemizedlist">
              <ul>
                <li> layers.layerId.className = Layer : defines the object as a 
            Layer; layerId is a string that uniquely identifies the object. The 
            general rules of syntax for a .ini file must be respected in the 
            choice of the layerId (e.g. no '-' are allowed). </li>
                <li> layers.layerId.msLayer = string : name of the corresponding 
            Mapserver layer in the mapfile </li>
                <li> layers.layerId.label = string : caption of the layer in the 
            layer tree on the client; this is a 'raw' label, before any 
            internationalization. The i18n scripts automatically include this 
            label in the strings that can be translated. </li>
                <li> layers.layerId.icon = filename : filename of the static picto 
            that illustrates this Layer in the layer tree. The path is relative 
            to <code class="filename">layers.ini</code>. See also <a href="user.layers.html#user.layers.legend" title="6.4. Layers Legends">Section 6.4, &#8220;Layers Legends&#8221;</a> for a description of the automatic 
            legending process. </li>
                <li> layers.layerId.link = url : provides a link for the layer 
            (e.g. to some metadata); makes the caption in the tree clickable. 
            </li>
              </ul>
            </div>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.layers.tree.layergroups"></a>6.2.3. LayerGroups Options</h3>
                </div>
              </div>
            </div>
            <p> <a id="id2606725" class="indexterm"></a> Here is the 
        syntax for the various configuration parameters of LayerGroups. Note 
        that a special LayerGroup with layerId=root must be 
        <a id="id2573080" class="indexterm"></a> present. 
        Unsurprisingly, it is the root (top level) of the hierarchy. It doesn't 
        appear in the visible tree.</p>
            <div class="itemizedlist">
              <ul>
                <li> layers.layerId.className = LayerGroup : defines the object as 
            a LayerGroup; layerId is a string that uniquely identifies the 
            object. The general rules of syntax for a .ini file must be 
            respected in the choice of the layerId (e.g. no '-' are allowed). 
            </li>
                <li> layers.layerId.children = list of layerIds : comma-separated 
            list of layerIds; these children may be Layers or other 
            LayerGroups. </li>
                <li> layers.layerId.aggregate = true|false : if true, the children 
            objects are not listed in the tree and not individually selectable. 
            Default is false. </li>
                <li> layers.layerId.label = string : caption of the layer in the 
            layer tree on the client; this is a 'raw' label, before any 
            internationalization. The i18n scripts automatically include this 
            label in the strings that can be translated. </li>
                <li> layers.layerId.icon = filename : filename of the static picto 
            that illustrates this Layer in the layer tree. The path is relative 
            to <code class="filename">myMap.ini</code>.See also <a href="user.layers.html#user.layers.legend" title="6.4. Layers Legends">Section 6.4, &#8220;Layers Legends&#8221;</a> for a description of the automatic 
            legending process. </li>
                <li> layers.layerId.link = url : provides a link for the layer 
            (e.g. to some metadata); makes the caption in the tree clickable. 
            </li>
                <li> layers.layerId.rendering = tree|block|radio|dropdown : 
            indicates how to display the LayerGroup children.<div class="itemizedlist"><ul><li> tree (default value): children layers are rendered below 
                the LayerGroup with an indentation. If children are not 
                declared as "frozen" or "hidden" they will be preceded by a 
                checkbox input. A node folding/unfolding link is displayed 
                before the LayerGroup. </li><li> radio: quite similar to the "tree" rendering with "radio" 
                buttons replacing checkboxes. Only one child layer can be 
                selected at a time. </li><li> block: children layers are separated as blocks (separation 
                medium depends on the template layout). Note that the rendering 
                will be applied to the children, not to the LayerGroup itself, 
                which is not displayed at all. </li><li> dropdown: as for block rendering, the LayerGroup is not 
                displayed. Its children are simply rendered as an HTML "simple 
                select" options list. If the selected child layer cannot be 
                determined using posted or session-saved data, first child 
                (according to the layers.layerId.children list order) is 
                selected. If any, only the selected child layer's own children 
                are displayed under the dropdown list. </li></ul></div></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.layers.metadata"></a>6.3. Metadata in Mapfile and <code class="filename">layers.ini</code></h2>
              </div>
            </div>
          </div>
          <p> Metadata are (keyword, value) pairs which can be associated to a 
      MapServer layer in the mapfile, or to a Layer or LayerGroup in the 
      layers.ini configuration file. These metadata are used in several 
      different contextes, such as layer specific configuration, security 
      handling, ... The metadata related to the functionalities of CartoWeb 
      are described in the documentation of the corresponding plugins. </p>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.layers.metadata.mapfile"></a>6.3.1. Metadata in Mapfiles</h3>
                </div>
              </div>
            </div>
            <p> Specifying metadata in mapfiles is based on the standard MapServer 
        syntax. For instance: </p>
            <pre class="programlisting">LAYER
  NAME "my_layer"
  [...]
  METADATA
    "exported_values" "security_view,security_edit"
    "security_view" "admin" 
    "security_edit" "admin,editors"
    
    "id_attribute_string" "FID|string" 
    "mask_transparency" "50"
    "mask_color" "255, 255, 0"
    "area_fixed_value" "10"
  END
  [...]
END</pre>
            <p>The metadata key <code class="constant">exported_values</code> is a bit 
        special: It gives the list of metadata keys (coma separated), which 
        will be transmitted to the client. This is required for the metadata 
        keys describing layer security for instance, as they are used on the 
        CartoClient. </p>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.layers.metadata.inifile"></a>6.3.2. Metadata in <code class="filename">layers.ini</code></h3>
                </div>
              </div>
            </div>
            <p> The configuration file <code class="filename">layers.ini</code> may also 
        contain metadata (key, value) pairs. This is needed for LayerGroup 
        objects, as these have no counterparts in the mapfile. For simple 
        layers, the metadata specified in the <code class="filename">layers.ini</code> 
        take precedence over the values from the mapfile. </p>
            <p> For each layer object in the <code class="filename">layers.ini</code> file, 
        the following syntax is used to set metadata:</p>
            <div class="itemizedlist">
              <ul>
                <li> layers.layerId.metadata.METADATA = value </li>
              </ul>
            </div>
            <p>For instance:</p>
            <pre class="programlisting">layers.group_admin.className = LayerGroup 
layers.group_admin.children = grid_defaulthilight 
layers.group_admin.metadata.security_view = admin</pre>
          </div>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.layers.legend"></a>6.4. Layers Legends</h2>
              </div>
            </div>
          </div>
          <p> <a id="id2578477" class="indexterm"></a> CartoWeb includes 
      a mechanism for the automatic generation of legends. If desired, an icon 
      is drawn for each class of the layers. There are two conditions that must 
      be fulfilled to make it work : </p>
          <p> 1. The mechanism must be enabled by setting</p>
          <pre class="programlisting">autoClassLegend = true</pre>
          <p><a id="id2578489" class="indexterm"></a> in 
      <code class="filename">layers.ini</code>. </p>
          <p> 2. Each class (or more precisely each class that should appear in 
      the legend) must have a name. Here an example : </p>
          <p>
      </p>
          <pre class="screen">LAYER
  NAME "spur_spurweite"
  METADATA
  ...
  END
  TYPE line
  ...

  CLASS
    NAME "Normalspur (1435 mm)"
    EXPRESSION ([MM] = 1435)
    STYLE
      COLOR 0 0 255 # blue
    END
  END

  CLASS
#   NAME "Meterspur (1000 mm)"
    EXPRESSION ([MM] = 1000)
    STYLE
      COLOR 255 0 0 # red
    END
  END

  CLASS
    NAME "Schmalspur (&lt; 900 mm)"
    EXPRESSION ([MM] &lt; 900)
    STYLE
      COLOR 128 0 128 # lila
    END
  END

END
</pre>
          <p>
    </p>
          <p> In this case, the second class would not appear in the legend, 
      because the NAME is commented out. </p>
          <p> Provided that no static icon is defined for a layer in 
      <code class="filename">layers.ini</code>, the icon of the first visible class is 
      used for the layer. </p>
        </div>
      </div>
    </div>
  </body>
</html>
