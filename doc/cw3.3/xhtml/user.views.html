<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>13. Views</title>
    <link rel="stylesheet" href="document.css" type="text/css" />
    <meta name="generator" content="Tiny DocBook - 1.6.16" />
  </head>
  <body>
    <div id="prev_next">
      <p id="prev">
        <a accesskey="p" href="user.pdf.html">
       &lt; PDF Export</a>
      </p>
      <p id="next">
        <a accesskey="n" href="user.edit.html">Editing &gt;
     </a>
      </p>
    </div>
    <div id="navtoc">
      <div id="nav">
        <ul>
          <li>
            <a accesskey="h" href="index.html">CartoWeb Documentation</a>
          </li>
          <li>
            <a accesskey="u" href="cartoweb.user.html">User Manual</a>
          </li>
        </ul>
      </div>
      <div id="toc">
        <p>Table of Contents</p>
        <ul>
          <li>
            <span class="sect1">
              <a href="user.views.html#user.views.intro">13.1. Introduction</a>
            </span>
          </li>
          <li>
            <span class="sect1">
              <a href="user.views.html#user.views.config">13.2. Views Configuration</a>
            </span>
            <ul>
              <li>
                <span class="sect2">
                  <a href="user.views.html#user.views.config.plugin">13.2.1. Views Plugin</a>
                </span>
              </li>
              <li>
                <span class="sect2">
                  <a href="user.views.html#user.views.config.controller">13.2.2. Main Views Controller</a>
                </span>
              </li>
            </ul>
          </li>
          <li>
            <span class="sect1">
              <a href="user.views.html#user.views.usage">13.3. Views Usage</a>
            </span>
            <ul>
              <li>
                <span class="sect2">
                  <a href="user.views.html#user.views.usage.loading">13.3.1. Loading Views</a>
                </span>
              </li>
              <li>
                <span class="sect2">
                  <a href="user.views.html#user.views.usage.editing">13.3.2. Editing Views</a>
                </span>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <div id="title">
      <h2 class="title"><a id="user.views"></a>13. <a id="id2590011" class="indexterm"></a>Views</h2>
    </div>
    <div id="content">
      <div class="chapter" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div></div>
          </div>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.views.intro"></a>13.1. Introduction</h2>
              </div>
            </div>
          </div>
          <p>
   Views are recordings of CartoWeb maps states at a given moment. One may see them as a kind of bookmarks: while browsing maps in CartoWeb interface, users can save the current state (map extent, selected layers, queries, annotations, etc.) under a label of their choice. It is then possible to access later those saved states.
  </p>
          <p>
   Views are shared among users and are - in the current version - available to every user. Access to views edition functionalities (creation, modification, deletion) can be restricted to some categories of users. The default configuration only allows "admin"-roled users to perform view edition.
  </p>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.views.config"></a>13.2. <a id="id2599219" class="indexterm"></a>Views Configuration</h2>
              </div>
            </div>
          </div>
          <p>
   The views device consists of two parts:
   </p>
          <div class="itemizedlist">
            <ul>
              <li>
      a main controlling system that handles views detection, loading, recording and storage.
     </li>
              <li>
      a "views" plugin that provides a graphical interface for performing views loading and edition. This plugin is not mandatory to have views working but greatly enhances the device usability. 
     </li>
            </ul>
          </div>
          <p>
  </p>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.views.config.plugin"></a>13.2.1. Views Plugin</h3>
                </div>
              </div>
            </div>
            <p>
    No configuration is required for that plugin. However it still needs to be activated using the <code class="filename">client_conf/client.ini</code> <em class="parameter"><code>loadPlugins</code></em> parameter. For instance: </p>
            <pre class="programlisting">loadPlugins = auth, exportPdf, views</pre>
            <p>
   </p>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.views.config.controller"></a>13.2.2. Main Views Controller</h3>
                </div>
              </div>
            </div>
            <p>
    Main views controller configuration is done in the <code class="filename">client_conf/client.ini</code> file. The dedicated parameters are:
    </p>
            <div class="itemizedlist">
              <ul>
                <li>
       <em class="parameter"><code>viewOn</code></em> (boolean: 'true'|'false'): activates/deactivates the main view controller. Views plugin will not work if the controller is off.
      </li>
                <li>
       <em class="parameter"><code>viewStorage</code></em> (string: 'file'|'db'): tells what storage container must be used: file or database.
      </li>
                <li>
       <em class="parameter"><code>viewablePlugins</code></em> (comma-separated list of strings): list of plugins that must have their data saved in views. Note that "viewable" plugins must implement the Sessionable interface. If you wish to save data from extended plugins, you must add the extended plugin to the list, not the standard one (eg. <code class="filename">myLocation</code> instead of <code class="filename">location</code>).
      </li>
                <li>
       <em class="parameter"><code>viewMetas</code></em> (comma-separated list of strings): list of metadata fields that must be saved in addition to the viewable plugins data (for instance author, email, description...). Common metadata fields such as "viewTitle" are anyway saved. Note that metadata fields must have homonym form fields in <code class="filename">plugins/views/templates/views.tpl</code> to be taken into account.
      </li>
                <li>
       <em class="parameter"><code>viewDsn</code></em> (string): DSN (Data Source Name), gives the database connection parameters. Only used in database storage mode. Any DSN format supported by PEAR::DB can be used. See PEAR::DB manual for more info about DSNs at <a href="http://pear.php.net/manual/en/package.database.db.intro-dsn.php">http://pear.php.net/manual/en/package.database.db.intro-dsn.php</a>. Note that you can call any database server type as long as it is supported by PEAR::DB and that your PHP distribution has the matching extension enabled.
      </li>
                <li>
       <em class="parameter"><code>viewAuth</code></em> (comma-separated list of strings): list of roles allowed to perform views edition actions. Given roles must match <code class="filename">client_conf/auth.ini</code> defined ones. See also <a href="user.security.html" title="15. Security Configuration">Chapter 15, <i>Security Configuration</i></a>.
      </li>
                <li>
       <em class="parameter"><code>viewSavedRequest</code></em> (comma-separated list of strings): list of REQUEST variables (GET, POST, COOKIE) that must be preserved when loading a view. Some are already built-in listed such as <em class="parameter"><code>tool</code></em>, <em class="parameter"><code>js_folder_idx</code></em>, <em class="parameter"><code>project</code></em>, <em class="parameter"><code>collapse_keymap</code></em> and views related parameters. Adding other CartoWeb reserved REQUEST variables names to the list may prevent the view system from working correctly.
      </li>
                <li>
       <em class="parameter"><code>viewLogErrors</code></em> (boolean): if true, outdated views loadings will be logged in <code class="filename">log/viewErrors.log</code>.
      </li>
                <li>
       <em class="parameter"><code>viewUpgradeOutdated</code></em> (boolean): if true, CartoWeb will try to upgrade outdated views on the fly. Else view outdated parts will be discarded and current plugin session data will be used instead.
      </li>
                <li>
       <em class="parameter"><code>viewHooksClassName</code></em> (string): name of the PHP class used to customize some views processing. See <a href="dev.views_upgrade.html#dev.views_upgrade.hooks" title="11.3. Customizing Views Processing Using Project Hooks">Section 11.3, &#8220;Customizing Views Processing Using Project Hooks&#8221;</a> for details on how to write customized views hooks.
      </li>
              </ul>
            </div>
            <p>
    For instance:
    </p>
            <pre class="programlisting">; Views management
viewOn = true
viewStorage = db
viewablePlugins = location, layers, query, outline
viewMetas = author
viewDsn = pgsql://www-data@localhost/cw3
viewAuth = admin,
viewSavedRequest = personalVar1, personalVar2
viewLogErrors = true
viewUpgradeOutdated = true
viewHooksClassName = FoobarViewHooks
</pre>
            <p>
   </p>
            <p>
    Should you decide to use a database storage, you would need first to create an appropriate table called <em class="parameter"><code>views</code></em>. Here is an example of SQL statements for PostgreSQL:
    </p>
            <pre class="programlisting">
CREATE TABLE views (
        views_id serial NOT NULL PRIMARY KEY,
        views_ts timestamp without time zone,
        viewtitle character varying(50),
        author character varying(50),
        sessiondata text,
        viewshow boolean,
        weight integer
);</pre>
            <p>
   </p>
            <div class="tip">
              <h3 class="title">Tip</h3>
              <p>
       Field "views_ts" is just present in table "views" but not visible in the graphical interface of the "views" plugin. This value 
       is usefull to know the time of the creation/modification of a view (only available with option "viewStorage = db"). 
     </p>
            </div>
          </div>
        </div>
        <div class="sect1" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="user.views.usage"></a>13.3. Views Usage</h2>
              </div>
            </div>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.views.usage.loading"></a>13.3.1. <a id="id2629925" class="indexterm"></a>Loading Views</h3>
                </div>
              </div>
            </div>
            <p>
    Any defined view may be loaded by any users. Loading a view may be achieved selecting it among a dropdown views list. Two dropdown lists are available:
    </p>
            <div class="itemizedlist">
              <ul>
                <li>
       a public one that only displays views labels that have been marked as "visible" by their creators.
      </li>
                <li>
       a selector within the Views plugin edition interface. This view selector contains all views including the ones that have not been marked as "visible" by their creators. Note that this selector provides a view ID (integer) input as well.
      </li>
              </ul>
            </div>
            <p>
   </p>
            <p>
    Views may also be loaded using GET parameters in URLs that look like:
    </p>
            <pre class="programlisting">http://&lt;cartoweb/client/base/url&gt;?handleView=1&amp;viewLoad=1&amp;viewLoadId=&lt;viewId&gt;</pre>
            <p>
    or simply
    </p>
            <pre class="programlisting">http://&lt;cartoweb/client/base/url&gt;?view=&lt;viewId&gt;</pre>
            <p>
   </p>
            <div class="tip">
              <h3 class="title">Tip</h3>
              <p>
     Views not marked as "visible" may anyway be loaded by anyone. "Visible" only means that their labels appear in the public view dropdown selector whereas "invisible" ones don't.
    </p>
            </div>
          </div>
          <div class="sect2" lang="en" xml:lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user.views.usage.editing"></a>13.3.2. Editing Views</h3>
                </div>
              </div>
            </div>
            <p>
    Views edition is restricted to users whom roles match at least one of those specified in the <code class="filename">client_conf/client.ini</code> <em class="parameter"><code>viewAuth</code></em> parameter (see <a href="user.views.html#user.views.config.controller" title="13.2.2. Main Views Controller">Section 13.2.2, &#8220;Main Views Controller&#8221;</a>).
   </p>
            <p>
    Views editors can create, update or delete views.
   </p>
            <div class="sect3" lang="en" xml:lang="en">
              <div class="titlepage">
                <div>
                  <div>
                    <h4 class="title"><a id="user.views.usage.editing.create"></a>13.3.2.1. <a id="id2630665" class="indexterm"></a> Saving a View</h4>
                  </div>
                </div>
              </div>
              <p>
     To save the current map state as a view, simply fill in the form fields with matching metadata. To make the view "visible", check the "Show view" option. Finally push the "save" button.
    </p>
              <p>
     You may also save a new view using an existing view. To do so, load the desired view as described in <a href="user.views.html#user.views.usage.loading" title="13.3.1. Loading Views">Section 13.3.1, &#8220;Loading Views&#8221;</a>, modify it as explained in <a href="user.views.html#user.views.usage.editing.update" title="13.3.2.3. Updating a View">Section 13.3.2.3, &#8220;Updating a View&#8221;</a> and push the "Save as new view" button.
    </p>
            </div>
            <div class="sect3" lang="en" xml:lang="en">
              <div class="titlepage">
                <div>
                  <div>
                    <h4 class="title"><a id="user.views.usage.editing.delete"></a>13.3.2.2. <a id="id2630697" class="indexterm"></a>Deleting a View</h4>
                  </div>
                </div>
              </div>
              <p>
     Load the view you want to delete as shown above and push the "Delete" button. A JavaScript confirmation pops before irreversible deletion.
    </p>
            </div>
            <div class="sect3" lang="en" xml:lang="en">
              <div class="titlepage">
                <div>
                  <div>
                    <h4 class="title"><a id="user.views.usage.editing.update"></a>13.3.2.3. <a id="id2630715" class="indexterm"></a>Updating a View</h4>
                  </div>
                </div>
              </div>
              <p>
     To modify a view map properties (selected layers, annotations, map extent, etc.) as well as its metadata (title, "visibility", etc.), load it as seen above.
    </p>
              <p>
     If your changes only concern metadata, simply update the dedicated form fields and push the "Update" button.
    </p>
              <p>
     To update the view map properties, check the "Memorize form" option. Metadata and selected view ID are then memorized while you perform your changes (pans, zooms, annotations, layers selections, etc.). Eventually push the "Update" button.
    </p>
            </div>
          </div>
        </div>
      </div>
      <div id="w3c">
        <a href="http://validator.w3.org/check/referer">
          <img src="image/xhtml.png" width="88" height="31" alt="valid xhtml 1.0" />
        </a>
        <a href="http://jigsaw.w3.org/css-validator/">
          <img src="image/css.png" width="88" height="31" alt="valid css" />
        </a>
      </div>
    </div>
  </body>
</html>
