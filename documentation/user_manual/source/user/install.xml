<?xml version="1.0" encoding='ISO-8859-1'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
  "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % cartoweb SYSTEM "../cartoweb.ent" >
  %cartoweb;
]>

<!-- $Id$ -->

<chapter id="user.install">
  <title>Installation</title>

  <sect1 id="user.install.main">
    <title>&cartoweb; Installation</title>

    <sect2 id="user.install.main.prerequisite">
      <title>Prerequisite for Installing &cartoweb;</title>
      <para>&cartoweb; depends on several sofware components for its proper
        working. Some are required and others are optional, depending on what you
        intend to do.
        <note>
          <para> Windows users can ignore this chapter and go directly to 
            <xref linkend="user.install.main.download"/></para>
        </note>
        </para>

      <para>Required software
        <variablelist>
            <title>A Web Server</title>
            <varlistentry><term></term>
              <listitem>
                <para>Such as Apache <ulink url="http://httpd.apache.org"/></para>
              </listitem>
            </varlistentry>
        </variablelist>
        <variablelist>
          <title>PHP >= 5.0.3</title>
          <varlistentry><term></term>
            <listitem>
              <para> See <ulink url="http://www.php.net"/> for more informations.
                You will need to have some features available in PHP:
                <itemizedlist>
                  <listitem>
                    <para><emphasis>Gettext</emphasis> (optional): You need the Gettext module if you want
                      to enable the Internationalisation in &cartoweb;. See
                      <xref linkend="user.i18n"/> for configuration.
                      <note>
                        <para> If you are using the demo, you need to have Gettext
                          support installed, as it uses Gettext by default.
                        </para>
                      </note>
                      If you are using Cygwin, simply install the <emphasis>gettext-devel</emphasis> package.
                    </para>
                  </listitem>
                  <listitem>
                    <para><emphasis>Curl</emphasis> (optional): Some scripts (like i18n) need Curl 
                        to fetch files remotely.</para>
                  </listitem>              
                  <listitem>
                    <para><emphasis>SOAP</emphasis> (optional if using direct mode only): You need the SOAP module if you want 
                    to use &cartoweb; as a Webservice or with separated &cartoclient; and &cartoserver;. This is related to the <literal>cartoserverDirectAccess</literal> 
                    parameter described in <xref linkend="user.config.client"/></para>
                  </listitem>
                </itemizedlist>
                <note><para>
                If you are using Windows, simply use the Windows Installer 
                <xref linkend="user.install.main.download"/>. If you absolutly want to install 
                PHP manually, see <xref linkend="appendix.windows_manual_install"/>.
              </para></note>
              </para>
            </listitem>
          </varlistentry>
        </variablelist>

        <variablelist>
          <title>MapServer PHP/MapScript (from MapServer &gt;= 4.4)</title>
          <varlistentry><term></term>
            <listitem>  
              <para>See <ulink url="http://www.maptools.org/php_mapscript/"/>
                for more information and installation instructions.</para>
              <note><para>
                If you are using Debian, and you need to install MapServer, you can have a 
                look at <xref linkend="appendix.debian_mapserver"/>
              </para></note>
              <note><para>
                If you are using Windows, simply use the Windows Installer 
                <xref linkend="user.install.main.download"/>. If you absolutely want to install 
                MapServer manually, see <xref linkend="appendix.windows_manual_install"/>.
              </para></note>
            </listitem>
          </varlistentry>
        </variablelist>
        <variablelist>
          <title>PostgreSQL with PostGIS Suppport (Optional)</title>
          <varlistentry><term></term>
            <listitem>
              <para>If you want spatial database support in &cartoweb; you
              will need to install PostGIS of the PostgreSQL database.
              See <ulink url="http://postgis.refractions.net/"/> 
              for more information.</para>
            </listitem>
          </varlistentry>
        </variablelist>
      </para>
    </sect2>
    
    <sect2 id="user.install.main.download">
      <title>CartoWeb Download</title>
      <para>
      There are two ways to get &cartoweb;:
      </para>
      <orderedlist>
        <listitem>
          <formalpara><title>Complete package from the official website:</title>
            <para>
              <itemizedlist mark='opencircle'>
                <listitem>
                  <para>Download &cartoweb; package from <ulink url="http://cartoweb.org/download.html"/>.
                    It is recommended that you download the version with demo for a better
                    user experience.</para>
                </listitem>
                <listitem>
                  <para>
                    Uncompress the archive somewhere in your path accessible by your web 
                    server.
                  </para>
                </listitem>
              </itemizedlist>
            </para>
          </formalpara>
        </listitem>
        <listitem>
          <formalpara><title>From CVS:</title>
            <para>Get the current development version via CVS using the following command:
            <screen><![CDATA[
  cvs -d :pserver:anonymous@dev.camptocamp.com:/var/lib/cvs/public checkout cartoweb3            
             ]]></screen>
            </para>
          </formalpara>
          <formalpara><title>From CVS with cw3setup.php:</title>
            <para>If you already have the <filename>cw3setup.php</filename> file, which comes along the &cartoweb; package 
            or CVS source, you can fetch &cartoweb; from CVS and set up it at once. See 
            <xref linkend="user.install.main.setup.example.reinstall"/> for more details.</para>
          </formalpara>
        </listitem>
      </orderedlist>
      <para>
        Once you have &cartoweb;, point your web browser to the file located in 
        <filename>htdocs/info.php</filename>, and check that the PHP
        information page displays correctly (meaning PHP is correctly setup)
        and that you have do not have a WARNING message at the top of the page
        about MapScript failing to load.
        If it is not the case, &cartoweb; will not run correctly. You should
        install and set up PHP and PHP/MapScript correctly. See 
          <xref linkend="user.install.main.prerequisite"/>.
      </para>
      <para>
        If you intend to use the &cartoweb; demo, you need to have a section
        called Gettext in the previous output.
      </para>
    </sect2>

    <sect2 id="user.install.main.setup">
      <title>UNIX-like Installation</title>
      <para>
        &cartoweb; installer is <filename>cw3setup.php</filename>, located in the root directory of the application.
      </para>
      <para>
        You can run this file with the <literal>--help</literal> parameter to see the 
        available options. For instance:
        <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --help</screen>
        where &lt;PHP-INTERPRETER&gt; is the location of your php interpreter. On
        Windows, it can be <literal>c:\wamp\php\php.exe</literal> or on Unix
        <literal>/usr/lib/cgi-bin/php</literal>.
      </para>

      <sect3 id="user.install.main.setup.commands.list">
        <title>List of Available Options</title>
        <para>
          <screen><![CDATA[
Usage: cw3setup.php [OPTION]...

 --help, or -h              display this help and exit
 --version or -v            output version information and exit
 --debug                    turn on output debugging
 --install                  install CartoWeb
 
 --writableowner OWNER      the user who should have write permissions for generated files
 
 --cvs-root                 CVS Root directory to use when fetching CartoWeb/project out of CVS
 --fetch-from-cvs           fetch CartoWeb from cvs and install it in the current directory, or in
                             the directory given by the --install-location parameter
                            NOTE: You must be located where cartoweb3 directory will be created, not inside like other commands
 --cartoweb-cvs-option OPTIONS  A string which will be given to the cvs checkout command of cartoweb (not projects!).
                              For instance, to fetch a specific branch, use '-r MY_BRANCH'. Or for a specific date, use '-D "2005-09-05 11:00"'
 --fetch-from-dir DIRECTORY  Copy CartoWeb for the specified directory into the current directory, or in
                             the directory given by the --install-location parameter
                            NOTE 1: You must be located where cartoweb3 directory will be created, not inside like other commands
                            NOTE 2: You need to use a path relative to the target cartoweb3 directory (or you can 
                                  user an absolute path).
 --install-location         directory where to install CartoWeb (when using --fetch-from-cvs/dir options)
 
 --delete-existing          overwrite existing directories if already there
 --no-symlinks              do not use symbolic links, even if your operating system supports them
 
 --config-from-file FILE    location of a configuration file for automatic variable replacement in .in files
                            NOTE: You need to use a path relative to the target cartoweb3 directory (or you can 
                                  user an absolute path).
 --config-from-project PROJECT read the configuration file containing variables to replace in .in files from
                             the specified project. 
 
 --fetch-project-cvs PROJECT fetch the given project from CVS (see --cvs-root option)
 --fetch-project-dir DIRECTORY fetch the given project from a directory
 
 --default-project PROJECT  the project to use by default (this is set automatically if using --config-from-project)
 --base-url BASEURL         URL where you can find client.php
 --profile PROFILENAME      The profile to use (development/production)
 
 --clean                    clean generated files and caches
 --clean-views              clean views (must be used with --clean)
 
 --fetch-demo               fetch the demo data from cartoweb.org, and extract it in the demo project if
                             not already there.
          ]]></screen>
        </para>
      </sect3>

      <sect3 id="user.install.main.setup.example">
        <title>Examples of Use</title>
        <sect4 id="user.install.main.setup.example.basic">
          <title>Basic Setup</title>
          <para>
            To performe a basic setup of &cartoweb;, such as if you want to run the demo project, type:
            <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --install --base-url 
            http://www.example.com/cartoweb</screen>
            In this example, http://www.example.com/cartoweb is the address which corresponds
            to the <literal>cartoweb3/htdocs</literal> directory. You should find 
            <literal>client.php</literal> if you type this URL.
          </para>
        </sect4>
        <sect4 id="user.install.main.setup.example.directory">
          <title>Installing a Project from a Directory</title>
          <para>
            <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --install --fetch-project-dir 
            /home/foo/my_project --base-url http://www.example.com/cartoweb</screen>
          </para>
        </sect4>
        <sect4 id="user.install.main.setup.example.update">
          <title>Updating &cartoweb; after Modifications</title>
          <para>When you modify or add new content/features to &cartoweb;, you need to update it. 
          This will set relative links or copy new/modified resources files (templates, images, new plugins, ...)
            <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --install --base-url 
            http://www.example.com/cartoweb</screen>
            Same as <xref linkend="user.install.main.setup.example.basic"/>. Existing files 
            are not overwritten.
          </para>
        </sect4>
        <sect4 id="user.install.main.setup.example.clean">
          <title>Cleaning Generated Files (Map, PDF, Temporary Files and Smarty Cache)</title>
          <para>
            <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --clean</screen>
          </para>
        </sect4>
        <sect4 id="user.install.main.setup.example.demo">
          <title>Fetching the Demo Data</title>
          <para>
          <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --fetch-demo</screen>
          </para>
        </sect4>
        <sect4 id="user.install.main.setup.example.reinstall">
          <title>Install or Reinstall &cartoweb; from CVS and Set Up It at Once</title>
          <sect5 id="user.install.main.setup.example.reinstall.new">
            <title>Install</title>
            <para>
              <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --install --cvs-root 
              :pserver:anonymous@dev.camptocamp.com:/var/lib/cvs/public
              --fetch-from-cvs --base-url http://www.example.com/cartoweb</screen>
              <note>
                <para>Do no execute this command from the <filename>cartoweb3</filename> folder! Because this will fetch 
                the whole cartoweb3 hierarchy from cvs, including the <filename>cartoweb3</filename> folder. If you 
                executed this from the <filename>cartoweb3</filename> folder you would end up with something like 
                <filename>cartoweb3/cartoweb3/...</filename>. Instead, copy the <filename>cw3setup.php</filename> in the parent directory, 
                delete (or backup) the cartoweb3 folder and execute the commande. 
                </para>
              </note>
            </para>
          </sect5>
          <sect5 id="user.install.main.setup.example.reinstall.over">
            <title>Reinstall</title>
            <para>
              <screen>&lt;PHP-INTERPRETER&gt; cw3setup.php --install --cvs-root 
              :pserver:anonymous@dev.camptocamp.com:/var/lib/cvs/public
              --fetch-from-cvs --delete-existing --base-url http://www.example.com/cartoweb</screen>
              <warning><para>This command will automatically delete the existing <filename>cartoweb3/</filename> folder! Be sure to backup 
              the files and projects you wish to keep.</para></warning>
              <note>
                <para>See note on <xref linkend="user.install.main.setup.example.reinstall.new"/>. 
                Notice here the <emphasis>--delete-existing</emphasis> parameter. Needed here because 
                <filename>cartoweb3/</filename> already exists. Without it the cw3setup script issues a warning and stops.
                </para>
              </note>
            </para>
          </sect5>
        </sect4>
        <sect4 id="user.install.main.setup.example.cwupdate">
            <title>Update &cartoweb; from CVS</title>
            <para>To keep your &cartoweb; up-to-date with the development version, simply type 
            the following command in the <filename>&cartoweb;</filename> root folder:
            <screen><![CDATA[
  cvs -d :pserver:anonymous@dev.camptocamp.com:/var/lib/cvs/public update            
             ]]></screen>
              <warning><para>This may have some serious effects on your existing developments, 
              it is recommended you backup the &cartoweb; root folder and all subforders before execution.</para></warning>
            </para>
        </sect4>
      </sect3>
    </sect2>

    <sect2 id="user.install.win32">
      <title>Windows Installation</title>

      <sect3 id="user.install.win32.installer">
        <title>Windows Install with Win32 Installer (Recommended)</title>
        <para>
          Download the Windows installer (<xref linkend="user.install.main.download"/>), double-click on 
          the executable to launch it. This will install Apache with PHP (WAMP), MapServer and &cartoweb;.
        </para>
        <para>Once it is installed, you can set up &cartoweb; from either a DOS prompt or Cygwin.</para>
        <sect4 id="user.install.win32.installer.dos">
          <title>&cartoweb; Setup with DOS</title>
          <para>Open a command prompt (Start menu > Run > "cmd") and go to the &cartoweb; root:
            <screen>cd C:\wamp\www\cartoweb3</screen>
            Then see <xref linkend="user.install.main.setup.example.basic"/>
            <note><para>To enable you to execute PHP scripts easily (like <parameter>php cw3setup.php --someparameters</parameter> 
              instead of <filename>C:\wamp\php.exe cw3setup.php --someparameters</filename>), set the path to the PHP binary 
              in your PATH environment variable (control panel > system > Advanced > Environment Variables. 
              If there is no PATH variable, add a new one. If a PATH variable is already present, you can 
              add the path to php.exe at the end of the existing path values, but add a ";" inbetween: 
              path1;path2;path3):
              <screen><![CDATA[C:\wamp\php;]]></screen>
              The exemple above is true if the PHP binary are installed in <filename>C:\wamp\php</filename>.</para>
            </note>
            <note>
              <para> If you are using the demo, you need to have Gettext
                support installed, as it uses Gettext by default.
                If you used the win32 installer, Gettext is already installed, otherwise you must 
                install it manually. You can get a version of Gettext for Windows there 
                <ulink url="http://gnuwin32.sourceforge.net/packages/gettext.htm" />.
                Also set the path to the Gettext binary in your PATH environment variable.
                <screen><![CDATA[C:\Program Files\GnuWin32\bin;]]></screen>
                The exemple above is true if the Gettext binaries are installed in <filename>C:\Program Files\GnuWin32\bin</filename>.
                This is needed by the <filename>po2mo.php</filename> script to merge and compile the languages translation files.
              </para>
            </note>
            <note>
              <para>If you intend to use CVS in command line, you need to install a CVS client. 
                Use <ulink url="http://www.wincvs.org/" >WinCVS</ulink> 
                or <ulink url="http://www.tortoisecvs.org/download.shtml" >TortoiseCVS</ulink>, both 
                are free Open Source clients. 
                You must add the path to the CVS binary in your PATH environment variable.
                <screen><![CDATA[C:\Program Files\TortoiseCVS;]]></screen>
                The exemple above is true if you installed TortoiseCVS in <filename>C:\Program Files\TortoiseCVS</filename>.
              </para>
            </note>
          </para>
        </sect4>
        <sect4 id="user.install.win32.installer.cygwin">
          <title>&cartoweb; Setup with Cygwin</title>
          <para>Open a Cygwin window  and go to the &cartoweb; root:
            <screen>
cd C:
cd wamp/www/cartoweb3/</screen>
            Then see <xref linkend="user.install.main.setup.example.basic"/>
          </para>
          <note><para>
            You can download Cygwin here <ulink url="http://www.cygwin.com/"><citetitle>Cygwin</citetitle>
            </ulink>. When you install Cygwin, be sure to select the packages <emphasis>tar</emphasis> 
            (or <emphasis>unzip</emphasis>) and <emphasis>cvs</emphasis>. You can also install the 
            <emphasis>gettext-devel</emphasis> package, so you wont need to get an external gettext installation later.
            If you have already installed Cygwin, type the following command to see what package are currently installed.
            <screen>cygcheck -c</screen> If the packages mentioned above are not present, run Cygwin setup again 
            and add the missing packages.</para>
          </note>
          <note><para>
          To enable you to execute PHP scripts easily, set the path to the PHP binary in your 
            <filename>.bashrc</filename> (in <filename>C:\cygwin\home\Administrator\</filename> by default):
            <screen><![CDATA[export PATH=$PATH:/cygdrive/c/wamp/php]]></screen>
            The exemple above is true if the PHP binary are installed in <filename>c:\wamp\php</filename>.</para>
            <para>If you do not want to install the <emphasis>cvs</emphasis> and <emphasis>gettext</emphasis> Cygwin package, 
            you need to add also the path to the external CVS and gettext binaries. 
            <screen><![CDATA[export PATH=$PATH:/cygdrive/c/program Files/GnuWin32/bin
export PATH=$PATH:/cygdrive/c/program Files/TortoiseCVS]]></screen>
            See the note in 
            <xref linkend="user.install.win32.installer.dos"/></para>
          </note>

        </sect4>               
      </sect3>
      <sect3 id="user.install.win32.manual">
        <title>Windows Manual Install</title>
        <para>First follow instruction on <xref linkend="appendix.windows_manual_install"/> to install 
          PHP and MapServer manually on Windows.</para>
        <para>Then, if you have Cygwin, see <xref linkend="user.install.win32.installer.cygwin"/>. 
        If not, see <xref linkend="user.install.win32.installer.dos"/></para>
      </sect3>
    </sect2>
  </sect1>
</chapter>
